!function(a,b,c,d){"use strict";function g(b,c){this.element=b,this.options=a.extend({},f,c),this._defaults=f,this._name=e,this.init()}var e="photosetGrid",f={width:"100%",gutter:"0px",highresLinks:!1,lowresWidth:500,rel:"",borderActive:!1,borderWidth:"5px",borderColor:"#000000",borderRadius:"0",borderRemoveDouble:!1,onInit:function(){},onComplete:function(){}};g.prototype={init:function(){this.options.onInit(),this._setupRows(this.element,this.options),this._setupColumns(this.element,this.options)},_callback:function(a){this.options.onComplete(a)},_setupRows:function(b,c){if(c.layout)this.layout=c.layout;else if(a(b).attr("data-layout"))this.layout=a(b).attr("data-layout");else{for(var d="",e=1,f=0;f<a(b).find("img").length;f++)d+=e.toString();this.layout=d}this.rows=this.layout.split("");for(var g in this.rows)this.rows[g]=parseInt(this.rows[g],10);var h=a(b).find("img"),i=0;a.each(this.rows,function(a,b){var c=i,d=i+b;h.slice(c,d).wrapAll('<div class="photoset-row cols-'+b+'"></div>'),i=d}),a(b).find(".photoset-row:not(:last-child)").css({"margin-bottom":c.gutter})},_setupColumns:function(c,d){var e=this,f=function(e){function p(){var b=a(c).width().toString();b!==a(c).attr("data-width")&&(f.each(function(){var b=a(this).find("img:eq(0)");a(this).find("img").each(function(){var c=a(this);c.attr("height")<b.attr("height")&&(b=a(this)),parseInt(c.css("width"),10)>d.lowresWidth&&c.attr("data-highres")&&c.attr("src",c.attr("data-highres"))});var c=b.attr("height")*parseInt(b.css("width"),10)/b.attr("width"),e=Math.floor(.025*c);a(this).height(c-e),d.borderActive&&a(this).find(".photoset-content-border").each(function(){a(this).css({height:c-e})}),a(this).find("img").each(function(){a(this).attr("height")*parseInt(a(this).css("width"),10)/a(this).attr("width")})}),a(c).attr("data-width",b))}var f=a(c).find(".photoset-row"),g=a(c).find("img");d.highresLinks?(g.each(function(){var b;b=a(this).attr("title")?' title="'+a(this).attr("title")+'"':"";var c;c=a(this).attr("data-highres")?a(this).attr("data-highres"):a(this).attr("src"),a(this).wrapAll('<a href="'+c+'"'+b+' class="photoset-cell highres-link" />'),d.borderActive&&a(this).wrapAll('<span class="photoset-content-border" />')}),d.rel&&g.parent().attr("rel",d.rel)):g.each(function(){d.borderActive?(a(this).wrapAll('<div class="photoset-cell photoset-cell--border" />'),a(this).wrapAll('<div class="photoset-content-border" />')):a(this).wrapAll('<div class="photoset-cell" />')});var h=a(c).find(".photoset-cell"),i=a(c).find(".cols-1 .photoset-cell"),j=a(c).find(".cols-2 .photoset-cell"),k=a(c).find(".cols-3 .photoset-cell"),l=a(c).find(".cols-4 .photoset-cell"),m=a(c).find(".cols-5 .photoset-cell"),n=a(c).find(".photoset-content-border");a(c).css({width:d.width}),f.css({clear:"left",display:"block",overflow:"hidden"}),h.css({"float":"left",display:"block","line-height":"0","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}),g.css({width:"100%",height:"auto"}),d.borderActive&&n.css({display:"block",border:d.borderWidth+" solid "+d.borderColor,"border-radius":d.borderRadius,overflow:"hidden","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}),e&&g.each(function(){a(this).attr("height",a(this).height()),a(this).attr("width",a(this).width())}),i.css({width:"100%"}),j.css({width:"50%"}),k.css({width:"33.3%"}),l.css({width:"25%"}),m.css({width:"20%"});var o=parseInt(d.gutter,10);a(c).find(".photoset-cell:not(:last-child)").css({"padding-right":o/2+"px"}),a(c).find(".photoset-cell:not(:first-child)").css({"padding-left":o/2+"px"}),d.borderRemoveDouble&&(a(c).find(".photoset-row").not(":eq(0)").find(".photoset-content-border").css({"border-top":"none"}),a(c).find(".photoset-row").not(".cols-1").find(".photoset-content-border").not(":eq(0)").css({"border-left":"none"})),p(),a(b).on("resize",function(){p()})},g=!0,h=!0;a(c).find("img").each(function(){h&=!!a(this).attr("height")&!!a(this).attr("width")}),g=!h,g?a(c).imagesLoaded(function(){f(g),e._callback(c)}):(f(g),e._callback(c))}},a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new g(this,b))})};var h="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";a.fn.imagesLoaded=function(b){function l(){var d=a(j),f=a(k);e&&(k.length?e.reject(g,d,f):e.resolve(g)),a.isFunction(b)&&b.call(c,g,d,f)}function m(a){n(a.target,"error"===a.type)}function n(b,c){b.src!==h&&-1===a.inArray(b,i)&&(i.push(b),c?k.push(b):j.push(b),a.data(b,"imagesLoaded",{isBroken:c,src:b.src}),f&&e.notifyWith(a(b),[c,g,a(j),a(k)]),g.length===i.length&&(setTimeout(l),g.unbind(".imagesLoaded",m)))}var c=this,e=a.isFunction(a.Deferred)?a.Deferred():0,f=a.isFunction(e.notify),g=c.find("img").add(c.filter("img")),i=[],j=[],k=[];return a.isPlainObject(b)&&a.each(b,function(a,c){"callback"===a?b=c:e&&e[a](c)}),g.length?g.bind("load.imagesLoaded error.imagesLoaded",m).each(function(b,c){var e=c.src,f=a.data(c,"imagesLoaded");return f&&f.src===e?void n(c,f.isBroken):c.complete&&c.naturalWidth!==d?void n(c,0===c.naturalWidth||0===c.naturalHeight):void((c.readyState||c.complete)&&(c.src=h,c.src=e))}):l(),e?e.promise(c):c};var j,m,n,i=a.event,k={_:0},l=0;j=i.special.throttledresize={setup:function(){a(this).on("resize",j.handler)},teardown:function(){a(this).off("resize",j.handler)},handler:function(b,c){var d=this,e=arguments;m=!0,n||(setInterval(function(){l++,(l>j.threshold&&m||c)&&(b.type="throttledresize",i.dispatch.apply(d,e),m=!1,l=0),l>9&&(a(k).stop(),n=!1,l=0)},30),n=!0)},threshold:0}}(jQuery,window,document);